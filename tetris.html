<html>
    <body>
        <script src="https://code.jquery.com/jquery-2.1.0.js"></script>
        <script src="IPiece.js"></script>
        <script src="LPiece.js"></script>
        <script src="JPiece.js"></script>
        <script src="SPiece.js"></script>
        <script>
            var counter = 0;
            var pieceCounter = [];
            var piecePos;
            var pieceType;
            var piecelist = ["square", "line", "l"]

            $("body").append("<div id = 'leftWall' style = 'width: 1px; height: 400px; top: 0px; left: 0px; position: absolute; background-color: black;'></div>")
            $("body").append("<div id = 'rightWall' style = 'width: 1px; height: 400px; top: 0px; left: 200px; position: absolute; background-color: black;'></div>")
            $("body").append("<div id = 'topWall' style = 'width: 200px; height: 1px; top: 0px; left: 0px; position: absolute; background-color: black;'></div>")
            $("body").append("<div id = 'bottomWall' style = 'width: 200px; height: 1px; top: 400px; left: 0px; position: absolute; background-color: black;'></div>")

            $("body").append("<button id = 'pause' style = 'width: 50px; height: 30px; top: 10px; left: 250px; position: absolute; background-color: red;'>pause</button>")

            var createPiece = function(x, piece){
                if (piece === "square"){
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 0px; left: ${x * 20}px; background-color: yellow; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 0px; left: ${(x + 1) * 20}px; background-color: yellow; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 20px; left: ${x * 20}px; background-color: yellow; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 20px; left: ${(x + 1) * 20}px; background-color: yellow; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    pieceType = "o"
                }else if (piece === "line"){
                    x += 2
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 0px; left: ${x * 20}px; background-color: lightblue; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 20px; left: ${x * 20}px; background-color: lightblue; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 40px; left: ${x * 20}px; background-color: lightblue; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 60px; left: ${x * 20}px; background-color: lightblue; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    pieceType = "i";
                }else if (piece === "l"){
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 0px; left: ${x * 20}px; background-color: orange; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 20px; left: ${x * 20}px; background-color: orange; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 40px; left: ${x * 20}px; background-color: orange; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 40px; left: ${(x + 1) * 20}px; background-color: orange; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    pieceType = "l";
                }else if (piece === "j"){
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 0px; left: ${(x + 1) * 20}px; background-color: pink; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 20px; left: ${(x + 1) * 20}px; background-color: pink; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 40px; left: ${(x + 1) * 20}px; background-color: pink; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 40px; left: ${x * 20}px; background-color: pink; position: absolute; border: 1px ridge black"></div>`)
                    counter++;
                    pieceType = "j";
                }else if (piece === "s"){
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 0px; left: ${x * 20}px; background-color: red; position: absolute; border: 1px ridge black">0</div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 20px; left: ${x * 20}px; background-color: red; position: absolute; border: 1px ridge black">1</div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 20px; left: ${(x + 1) * 20}px; background-color: red; position: absolute; border: 1px ridge black">2</div>`)
                    counter++;
                    $("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 40px; left: ${(x + 1) * 20}px; background-color: red; position: absolute; border: 1px ridge black">3</div>`)
                    counter++;
                    pieceType = "s";
                }
                //$("body").append(`<div id = ${counter} class = ${pieceCounter.length} style = "width: 20px; height: 20px; top: 0px; left: ${x * 20}px; background-color: red; position: absolute; border: 2px ridge black"></div>`)
                pieceCounter.push([0, 0, 0]);
                piecePos = 0;
            }

            var right = 0;
            var left = 0;
            var down = 0;
            var tright = 0;
            var tleft = 0;
            var pause = 0;

            $("body").keydown(function(e){
                if (e.keyCode === 39){
                    right = 1;
                }
                if (e.keyCode === 37){
                    left = 1;
                }
                if (e.keyCode === 40){
                    down = 1;
                }
                if (e.keyCode === 68){
                    tright = 1;
                }
                if (e.keyCode === 65){
                    tleft = 1;
                }
            })

            $("body").keyup(function(e){
                if (e.keyCode === 39){
                    right = 0;
                }
                if (e.keyCode === 37){
                    left = 0;
                }
                if (e.keyCode === 40){
                    down = 0;
                }
                if (e.keyCode === 68){
                    tright = 0;
                }
                if (e.keyCode === 65){
                    tleft = 0;
                }
            })

            $("#pause").click(function(){
                if (pause === 0){
                    pause = 1;
                }else{
                    pause = 0;
                }
            })

            setInterval(function(){
                if (pause === 0){
                    for (i = 0; i < pieceCounter.length; i++){
                        pieceCounter[i][0] = 0;
                    }
                    for (i = 0; i < counter; i++){
                        var thisdiv = document.getElementById(i);
                        var hitdown = 0;
                        var hitright = 0;
                        var hitleft = 0;
                        for (j = 0; j < counter; j++){
                            if (i != j){
                                if (down === 0){
                                    if (document.getElementById(j).offsetTop === thisdiv.offsetTop + 20 && document.getElementById(j).offsetLeft === thisdiv.offsetLeft && thisdiv.className != document.getElementById(j).className){
                                        hitdown = 1;
                                    }
                                }else{
                                    if (document.getElementById(j).offsetTop === thisdiv.offsetTop + 40 && document.getElementById(j).offsetLeft === thisdiv.offsetLeft && thisdiv.className != document.getElementById(j).className){
                                        hitdown = 1;
                                    }
                                }
                                if (document.getElementById(j).offsetLeft === thisdiv.offsetLeft + 20 && document.getElementById(j).offsetTop === thisdiv.offsetTop && thisdiv.className != document.getElementById(j).className){
                                    hitright = 1;
                                }
                                if (document.getElementById(j).offsetLeft === thisdiv.offsetLeft - 20 && document.getElementById(j).offsetTop === thisdiv.offsetTop && thisdiv.className != document.getElementById(j).className){
                                    hitleft = 1;
                                }
                            }
                        }

                        if (down === 0){
                            if (hitdown === 1 || thisdiv.offsetTop >= 380){
                                pieceCounter[thisdiv.className][0] = 1;
                            }
                        }else{
                            if (hitdown === 1 || thisdiv.offsetTop >= 360){
                                pieceCounter[thisdiv.className][0] = 1;
                            }
                        }
                        if (hitright === 1 || thisdiv.offsetLeft >= 180 || thisdiv.className != pieceCounter.length - 1){
                            pieceCounter[thisdiv.className][1] = 1;
                        }
                
                        if (hitleft === 1 || thisdiv.offsetLeft <= 0 || thisdiv.className != pieceCounter.length - 1){
                            pieceCounter[thisdiv.className][2] = 1;
                        }
                    }
                    for (i = 0; i < counter; i++){
                        var thisdiv = document.getElementById(i)
                        if (pieceCounter[thisdiv.className][0] === 0){
                            if (down === 0){
                                thisdiv.style.top = thisdiv.offsetTop + 20 + "px"
                            }else{
                                thisdiv.style.top = thisdiv.offsetTop + 40 + "px"
                            }
                        }
                        if (right === 1 && pieceCounter[thisdiv.className][1] === 0){
                            thisdiv.style.left = thisdiv.offsetLeft + 20 + "px";
                        }
                        if (left === 1 && pieceCounter[thisdiv.className][2] === 0){
                            thisdiv.style.left = thisdiv.offsetLeft - 20 + "px";
                        }
                    }

                    var sameys = [];

                    for (var i = 0; i < counter; i++){
                        var alreadyin = "none";
                        for (j = 0; j < sameys.length; j++){
                            if (document.getElementById(i).offsetTop === sameys[j][0] && alreadyin === "none"){
                                alreadyin = j;
                            }
                        }
                        if (alreadyin != "none"){
                            sameys[alreadyin][1]++;
                        }else{
                            sameys.push([document.getElementById(i).offsetTop, 1]);
                        }
                    }

                    for (var i = 0; i < counter; i++){
                        for (var j = 0; j < sameys.length; j++){
                            if (document.getElementById(i).offsetTop === sameys[j][0] && sameys[j][1] === 10){
                                $("#" + i).fadeOut(1);
                            }
                        }
                    }

                    for (var i = 0; i < counter; i++){
                        for (var j = 0;j < sameys.length; j++){
                            if (document.getElementById(i).style.display === "none"){
                                pieceCounter[document.getElementById(i).className][0] = 1;
                            }
                        }
                    }

                    var shouldnew = 1;
                    for (i = 0; i < pieceCounter.length; i++){
                        if (pieceCounter[i][0] === 0){
                            shouldnew = 0;
                        }
                    }

                    if (shouldnew === 1){
                        createPiece(Math.floor(Math.random() * 8), piecelist[Math.floor(Math.random() * piecelist.length)]);
                    }
                }
            }, 300)

            var rotate = function(){
                var colliding = 0;
                
                if (pieceType === "i"){
                    IPiecerot(piecePos, pieceCounter.length - 1);
                    if (piecePos === 3){
                        piecePos = 0
                    }else{
                        piecePos++;
                    }
                }else if (pieceType === "l"){
                    LPiecerot(piecePos, pieceCounter.length - 1);
                    if (piecePos === 3){
                        piecePos = 0
                    }else{
                        piecePos++;
                    }
                }else if (pieceType === "j"){
                    JPiecerot(piecePos, pieceCounter.length - 1);
                    if (piecePos === 3){
                        piecePos = 0
                    }else{
                        piecePos++;
                    }
                }else if (pieceType === "s"){
                    SPiecerot(piecePos, pieceCounter.length - 1);
                    if (piecePos === 3){
                        piecePos = 0
                    }else{
                        piecePos++;
                    }
                }
            }

            setInterval(function(){
                if (pause === 0){
                    if (tleft === 1){
                        rotate();
                    }else if (tright === 1){
                        rotate();
                        rotate();
                        rotate();
                    }
                }
            }, 100)
        </script>
    </body>
</html>